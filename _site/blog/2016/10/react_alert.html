<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <meta name="robots" content="index,follow"/>
        <meta name="renderer" content="webkit" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui" />
        <meta name="keywords" content="react 实现全局 alert">
        <meta name="screen-orientation" content="portrait" />
        <meta name="full-screen" content="yes" />
        <meta name="browsermode" content="application" />
        <meta name="x5-orientation" content="portrait" />
        <meta name="x5-fullscreen" content="true" />
        <meta name="x5-page-mode" content="app" />
        <title>react 实现全局 alert</title>
        <link rel="shortcut icon" type="image/ico" href="/favicon.ico"/>
        <link href="https://fonts.googleapis.com/css?family=Architects+Daughter" rel="stylesheet">
        <link rel="stylesheet" href="/css/style.min.css">
        <link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.6.0/styles/github-gist.min.css">
        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    <body>
        <!-- HEADER -->
        <div id="header_wrap" class="outer">
            <header class="inner">
                <a id="forkme_banner" href="https://github.com/lq1228">View on GitHub</a>

                <h1 id="project_title"><a href="/">Liqian - GitHub.io</a></h1>
                <h2 id="project_tagline">Welcome to the Liqian's notes</h2>

            </header>
        </div>
            
        <div id="content-wrapper">
            <div class="main clearfix">
                <aside id="sidebar">
                    <ul class="side-nav">
                    </ul>
                </aside>

                <section id="main-cont">
                    <h1 id="react--alert">react 实现全局 alert</h1>

<p>react 已经用了有一段时间了，和之前用过的几个前端框架相比，对我来说，总体上更贴合个人的思维习惯。</p>

<p>但是，总有几个点还是不太顺心。比如层层传输的单向数据流(这个已经由 redux 完美解决)，还是就是今天要说的这个弹框插件也算是其中之一。</p>

<h2 id="section">背景</h2>

<p>早前常规页面开发中，肯定会遇到很多的弹框提示。当然，为了用其来方便，本人都是将其写成一个小插件，用的时候直接 <code class="highlighter-rouge">Dialog.alert('这是一个提示')</code> 这样就 OK，
不用在页面添加 HTML 代码(当然是由 JS 动态写入和消除啦)，引入 JS 后随手就用，非常方便。</p>

<p>但在 react 里，不能再像上述 JS 插件一样，实时的在页面时写入一个弹框 DOM ，即使可以，这也违背了 react 的初衷。</p>

<p>网上找了些 react 的弹出框，比如 <code class="highlighter-rouge">react-modal</code> 、<code class="highlighter-rouge">react-alert</code> 之类，都是弹出框的组件，需要的时候都要是写自身 component 里，
不能共用。非常不爽。</p>

<h2 id="section-1">实现方式</h2>

<p>实际上要实现一个全局的 alert 也很简单，写一个自定义的顶级 component ，实现如下功能：</p>

<ol>
  <li>包含一个 alert 的完整 html 和 功能；</li>
  <li>有一个 alert(msg) 方法，功能是显示这个 alert 信息；</li>
  <li>通过 <code class="highlighter-rouge">React.cloneElement</code> 将 alert 方法合并入这个 component 的所有子 component。</li>
</ol>

<p>这样的话，被此 component 包裹的所有子 component 都会在 <code class="highlighter-rouge">props</code> 中“继承”这个 <code class="highlighter-rouge">alert</code> 方法。
用的时候直接调用就行。</p>

<h2 id="section-2">简单示例</h2>

<p><code class="highlighter-rouge">BaseComponent.jsx</code></p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>    <span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span><span class="nx">Component</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>

    <span class="kr">import</span> <span class="nx">Modal</span> <span class="nx">from</span> <span class="s1">'react-modal'</span><span class="p">;</span>

    <span class="kr">class</span> <span class="nx">DialogFrame</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
        <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
            <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">openDialog</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">alertMsg</span><span class="p">:</span> <span class="kc">null</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="nx">_alert</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">openDialog</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="na">alertMsg</span><span class="p">:</span> <span class="nx">msg</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="nx">_alertClose</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
                <span class="na">openDialog</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">alertMsg</span><span class="p">:</span> <span class="s1">''</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
                    <span class="p">{</span>
                        <span class="cm">/*
                        * 一个子元素是 [object Object]
                        * 多个子元素晨 [object Array]
                        */</span>
                        <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="o">===</span> <span class="s1">'[object Array]'</span> <span class="p">?</span> 
                            <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">ele</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                                <span class="k">return</span> <span class="nx">React</span><span class="p">.</span><span class="nx">cloneElement</span><span class="p">(</span><span class="nx">ele</span><span class="p">,</span> <span class="p">{</span><span class="na">key</span><span class="p">:</span> <span class="nx">index</span><span class="p">,</span> <span class="na">alert</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alert</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)})</span>
                            <span class="p">})</span> <span class="p">:</span> 
                            <span class="nx">React</span><span class="p">.</span><span class="nx">cloneElement</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="p">{</span><span class="na">alert</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alert</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)})</span>
                    <span class="p">}</span>
                    <span class="o">&lt;</span><span class="nx">Modal</span>
                        <span class="nx">isOpen</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">openDialog</span><span class="p">}</span>
                        <span class="nx">className</span><span class="o">=</span><span class="s2">"modal-cont"</span>
                        <span class="nx">shouldCloseOnOverlayClick</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span>
                        <span class="nx">overlayClassName</span><span class="o">=</span><span class="s2">"modal-overlay before"</span>
                        <span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"title"</span><span class="o">&gt;</span><span class="err">提示</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>                        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"cont"</span><span class="o">&gt;</span>
                            <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">alertMsg</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>                            <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"btn"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">_alertClose</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="o">&gt;&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"ok"</span><span class="o">&gt;</span><span class="err">确定</span><span class="o">&lt;</span><span class="sr">/span&gt;&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>                    <span class="o">&lt;</span><span class="sr">/Modal</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">export</span> <span class="k">default</span> <span class="nx">DialogFrame</span><span class="p">;</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">ChildComponent.jsx</code></p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>
    <span class="o">&lt;</span><span class="nx">DialogFrame</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Header</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">Content</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/DialogFrame</span><span class="err">&gt;
</span>
</code></pre>
</div>

                    <!-- 多说评论框 start -->
                    <div id="ds_ele" class="ds-thread" data-thread-key="" data-title="react 实现全局 alert" data-url="http://lq1228.github.io/blog/2016/10/react_alert.html"></div>
                    <!-- 多说评论框 end -->
                    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
                    <script type="text/javascript">
                        var url = window.location.pathname;
                        url = url.substr(1, url.length -6).replace(/\//gi, '_');
                        document.getElementById('ds_ele').dataset.threadKey = url;
                        var duoshuoQuery = {short_name:"lq1228"};
                        (function() {
                            var ds = document.createElement('script');
                            ds.type = 'text/javascript';ds.async = true;
                            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                            ds.charset = 'UTF-8';
                            (document.getElementsByTagName('head')[0] 
                            || document.getElementsByTagName('body')[0]).appendChild(ds);
                        })();
                    </script>
                    <!-- 多说公共JS代码 end -->
                </section>
            </div>
        </div>
            
        <!-- FOOTER  -->
        <div id="footer_wrap" class="outer">
            <footer class="inner">
                <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
            </footer>
        </div>
        <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
        <script src="//cdn.jsdelivr.net/highlight.js/9.6.0/highlight.min.js"></script>
        <script src="/js/aside-nav.js"></script>
        <script>
            // baidu 统计
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "//hm.baidu.com/hm.js?146fe495fee020bf0e4dd701aa73965f";
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            })();
            // highlight
            hljs.initHighlightingOnLoad({useBR: true});
            $(document).ready(function() {
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });

                // http2
                var img = new Image();
                img.src = 'https://www.h2statistics.ml/';
            });
        </script>
    </body>
</html>
